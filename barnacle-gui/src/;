use std::fs::{self, create_dir_all};

use barnacle_lib::{config::CoreConfig, fs::config_dir};
use serde::{Deserialize, Serialize};

#[derive(Debug, Default, Serialize, Deserialize)]
pub struct GuiConfig {}

#[derive(Debug, Default, Serialize, Deserialize)]
pub struct Config {
    core: CoreConfig,
    gui: GuiConfig,
}

impl Config {
    pub fn load() -> Self {
        let path = config_dir().join("config.toml");
        if path.exists() {
            let contents = fs::read_to_string(path).unwrap();
            toml::from_str(&contents).unwrap()
        } else {
            let cfg = Config::default();
            cfg.save();
            cfg
        }
    }

    pub fn save(&self) {
        let contents = toml::to_string_pretty(self).unwrap();

        create_dir_all(config_dir()).unwrap();

        fs::write(config_dir().join("config.toml"), contents).unwrap();
    }
}
